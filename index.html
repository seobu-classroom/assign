<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°•ì˜ì‹¤ ë°°ì • ì‹œìŠ¤í…œ (ê³µìœ )</title>
    <style>
        body { font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif; background-color: #f0f2f5; padding: 20px; color: #333; }
        .box { background: white; padding: 20px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .input-row { margin-bottom: 10px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
        label { font-weight: bold; }
        input, select, textarea { padding: 8px; border: 1px solid #aaa; border-radius: 4px; }
        button { cursor: pointer; padding: 10px 20px; border: none; border-radius: 5px; font-weight: bold; color: white; }
        .btn-primary { background-color: #007bff; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-success { background-color: #28a745; }
        .btn-success:hover { background-color: #218838; }
        .btn-danger { background-color: #dc3545; }
        .btn-danger:hover { background-color: #c82333; }
        .btn-warning { background-color: #ffc107; color: #333; }
        .btn-warning:hover { background-color: #e0a800; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab { padding: 10px 20px; cursor: pointer; border: none; background: none; font-size: 16px; font-weight: bold; color: #666; border-bottom: 3px solid transparent; }
        .tab.active { color: #007bff; border-bottom-color: #007bff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .table-wrap { overflow-x: auto; background: white; border: 1px solid #999; margin-top: 20px; }
        table { width: 100%; min-width: 1000px; border-collapse: collapse; table-layout: fixed; }
        th, td { border: 1px solid #999; padding: 8px; vertical-align: top; font-size: 12px; }
        th { background-color: #e9ecef; text-align: center; height: 40px; border-bottom: 2px solid #555; }
        .room-cell { width: 100px; background-color: #dee2e6; text-align: center; font-weight: bold; vertical-align: middle; }
        
        .card { background-color: #e3f2fd; border: 1px solid #2196f3; padding: 6px; margin-bottom: 6px; border-radius: 3px; position: relative; font-size: 12px; }
        .card.conflict { background-color: #ffebee; border-color: #f44336; }
        .del-btn { position: absolute; top: 3px; right: 3px; background: red; color: white; width: 18px; height: 18px; font-size: 11px; border-radius: 50%; border: none; cursor: pointer; }
        
        .request-item { background: #f8f9fa; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
        .request-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .request-status { padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; }
        .status-pending { background: #ffc107; color: #333; }
        .status-approved { background: #28a745; color: white; }
        .status-rejected { background: #dc3545; color: white; }
        .request-info { font-size: 14px; line-height: 1.6; color: #666; }
        .request-actions { margin-top: 10px; display: flex; gap: 10px; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal.active { display: flex; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-close { background: none; border: none; font-size: 28px; cursor: pointer; color: #999; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        
        .badge { background: #dc3545; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 5px; }
        .checkbox-group { display: flex; gap: 15px; flex-wrap: wrap; padding: 10px; background: #f8f9fa; border-radius: 5px; }
        .sync-status { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-left: 10px; }
        .sync-status.synced { background: #d4edda; color: #155724; }
        .sync-status.syncing { background: #fff3cd; color: #856404; }
        .sync-status.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h2 style="margin-top: 0;">ğŸ“… ê°•ì˜ì‹¤ ë°°ì • ì‹œìŠ¤í…œ (ê³µìœ ) <span id="syncStatus" class="sync-status synced">âœ“ ì €ì¥ë¨</span></h2>
    
    <div class="box" id="roleSelector">
        <h3>ì‚¬ìš©ì ì—­í•  ì„ íƒ</h3>
        <p>ğŸ’¡ <strong>ì°¸ê³ :</strong> ì´ ì‹œìŠ¤í…œì€ ë¸Œë¼ìš°ì €ì— ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. íŒ€ì›ë“¤ê³¼ ê³µìœ í•˜ë ¤ë©´ ì›¹ì„œë²„ì— ë°°í¬í•˜ì„¸ìš”.</p>
        <p style="color: #666; font-size: 14px;">ğŸ”’ ê´€ë¦¬ì ëª¨ë“œëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
        <p style="color: #666; font-size: 14px;">ğŸ”” ê´€ë¦¬ìëŠ” ìƒˆ ìš”ì²­ ì‹œ ë¸Œë¼ìš°ì € ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.</p>
        <div class="input-row">
            <button class="btn-primary" onclick="setRole('admin')">ğŸ‘¨â€ğŸ’¼ ê´€ë¦¬ì ëª¨ë“œ</button>
            <button class="btn-success" onclick="setRole('user')">ğŸ‘¤ ì¼ë°˜ ì‚¬ìš©ì ëª¨ë“œ</button>
        </div>
    </div>
    
    <div id="mainScreen" style="display: none;">
        <div class="box">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>í˜„ì¬ ëª¨ë“œ:</strong> 
                    <span id="currentRole" style="padding: 5px 15px; border-radius: 15px; background: #007bff; color: white;"></span>
                </div>
                <div>
                    <button class="btn-warning" onclick="changeRole()">ì—­í•  ë³€ê²½</button>
                    <button class="btn-primary" onclick="refreshData()" style="background: #6c757d;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('schedule')">ğŸ“‹ ë°°ì •í‘œ</button>
            <button class="tab" id="requestTabBtn" onclick="showTab('request')">ğŸ“ ì‚¬ìš©ìš”ì²­ <span id="requestBadge" class="badge" style="display: none;">0</span></button>
        </div>
        
        <div id="scheduleTab" class="tab-content active">
            <div id="adminPanel" class="box" style="display: none;">
                <h3>ì¼ì • ì§ì ‘ ë“±ë¡ (ê´€ë¦¬ì ì „ìš©)</h3>
                <div class="input-row">
                    <label>ê¸°ê°„:</label>
                    <input type="date" id="startDate" value="2026-04-13">
                    <span>~</span>
                    <input type="date" id="endDate" value="2026-06-18">
                </div>
                <div class="input-row checkbox-group">
                    <label>ìš”ì¼:</label>
                    <label><input type="checkbox" name="chkDay" value="1" checked> ì›”</label>
                    <label><input type="checkbox" name="chkDay" value="2" checked> í™”</label>
                    <label><input type="checkbox" name="chkDay" value="3" checked> ìˆ˜</label>
                    <label><input type="checkbox" name="chkDay" value="4" checked> ëª©</label>
                    <label><input type="checkbox" name="chkDay" value="5" checked> ê¸ˆ</label>
                    <label><input type="checkbox" name="chkDay" value="6"> í† </label>
                </div>
                <div class="input-row">
                    <select id="roomSelect"></select>
                    <input type="time" id="startTime" value="13:30">
                    <span>~</span>
                    <input type="time" id="endTime" value="17:30">
                    <input type="text" id="courseName" placeholder="ê³¼ì •ëª… (í•„ìˆ˜)">
                    <input type="text" id="instructorName" placeholder="ê°•ì‚¬ëª…">
                    <button class="btn-primary" onclick="addSchedule()">+ ë“±ë¡</button>
                </div>
                
                <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">
                
                <h4 style="margin-bottom: 10px;">ğŸ“¤ CSV íŒŒì¼ ì¼ê´„ ì—…ë¡œë“œ</h4>
                <div class="input-row">
                    <input type="file" id="csvFile" accept=".csv" style="padding: 5px;">
                    <button class="btn-success" onclick="uploadCSV()">ğŸ“ CSV ì—…ë¡œë“œ</button>
                    <button class="btn-warning" onclick="downloadSampleCSV()" style="background: #17a2b8;">ğŸ“¥ ìƒ˜í”Œ ë‹¤ìš´ë¡œë“œ</button>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: #e7f3ff; border-radius: 5px; font-size: 12px;">
                    <strong>CSV íŒŒì¼ í˜•ì‹:</strong><br>
                    ê°•ì¢Œëª…,ê°•ì˜ì‹¤,ì‹œì‘ì¼,ì¢…ë£Œì¼,ìš”ì¼,ì‹œì‘ì‹œê°„,ì¢…ë£Œì‹œê°„,ê°•ì‚¬ëª…<br>
                    <span style="color: #666;">ì˜ˆ: ì—‘ì…€ê¸°ì´ˆ,207í˜¸,2026-04-20,2026-05-18,ì›”í™”ìˆ˜ëª©ê¸ˆ,13:00,17:00,ê¹€ì² ìˆ˜</span><br>
                    <span style="color: #666;">ìš”ì¼: ì›”í™”ìˆ˜ëª©ê¸ˆí†  ë˜ëŠ” ì›”,í™”,ìˆ˜ í˜•ì‹</span>
                </div>
                
                <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; font-size: 13px;">
                    ğŸ’¡ <strong>ì¼ì • ì‚­ì œ ë°©ë²•:</strong><br>
                    â€¢ <strong>ê°œë³„ ì‚­ì œ:</strong> ì¼ì • ì¹´ë“œì˜ Ã— ë²„íŠ¼ í´ë¦­<br>
                    â€¢ <strong>ì¼ê´„ ì‚­ì œ:</strong> ì¼ì • ì¹´ë“œë¥¼ ë”ë¸”í´ë¦­í•˜ë©´ ê°™ì€ ê³¼ì •ëª…ì˜ ëª¨ë“  ì¼ì • ì‚­ì œ
                </div>
            </div>
            
            <div id="userPanel" class="box" style="display: none;">
                <button class="btn-success" onclick="openRequestModal()" style="font-size: 16px; padding: 12px 24px;">ğŸ“ ê°•ì˜ì‹¤ ì‚¬ìš© ìš”ì²­í•˜ê¸°</button>
            </div>
            
            <div class="box">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <label>ì¡°íšŒ ì—°ë„/ì›”:</label>
                        <input type="number" id="viewYear" value="2026" style="width: 70px;" onchange="renderSchedule()">
                        <select id="viewMonth" onchange="renderSchedule()">
                            <option value="1">1ì›”</option><option value="2">2ì›”</option><option value="3">3ì›”</option>
                            <option value="4" selected>4ì›”</option><option value="5">5ì›”</option><option value="6">6ì›”</option>
                            <option value="7">7ì›”</option><option value="8">8ì›”</option><option value="9">9ì›”</option>
                            <option value="10">10ì›”</option><option value="11">11ì›”</option><option value="12">12ì›”</option>
                        </select>
                    </div>
                    <div>
                        <span>ì´ <strong id="totalCount">0</strong>ê°œ ì¼ì •</span>
                    </div>
                </div>
            </div>
            
            <div class="table-wrap">
                <table>
                    <thead id="scheduleHead"></thead>
                    <tbody id="scheduleBody"></tbody>
                </table>
            </div>
        </div>
        
        <div id="requestTab" class="tab-content">
            <div class="box">
                <h3 id="requestTabTitle">ê°•ì˜ì‹¤ ì‚¬ìš© ìš”ì²­ ê´€ë¦¬</h3>
                <div id="requestList"></div>
            </div>
        </div>
    </div>
    
    <div id="requestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ê°•ì˜ì‹¤ ì‚¬ìš© ìš”ì²­</h3>
                <div class="modal-close" onclick="closeRequestModal()">&times;</div>
            </div>
            <div class="form-group">
                <label>ìš”ì²­ì ì´ë¦„ *</label>
                <input type="text" id="reqRequesterName" placeholder="í™ê¸¸ë™">
            </div>
            <div class="form-group">
                <label>ê°•ì˜ì‹¤ *</label>
                <select id="reqRoom"></select>
            </div>
            <div class="form-group">
                <label>ë‚ ì§œ *</label>
                <input type="date" id="reqDate">
            </div>
            <div class="form-group">
                <label>ì‹œì‘ ì‹œê°„ *</label>
                <input type="time" id="reqStartTime" value="09:00">
            </div>
            <div class="form-group">
                <label>ì¢…ë£Œ ì‹œê°„ *</label>
                <input type="time" id="reqEndTime" value="18:00">
            </div>
            <div class="form-group">
                <label>ê³¼ì •ëª… *</label>
                <input type="text" id="reqCourseName" placeholder="ì˜ˆ: Python ê¸°ì´ˆ">
            </div>
            <div class="form-group">
                <label>ê°•ì‚¬ëª…</label>
                <input type="text" id="reqInstructorName" placeholder="ì„ íƒì‚¬í•­">
            </div>
            <div class="form-group">
                <label>ì‚¬ìš© ëª©ì </label>
                <textarea id="reqPurpose" rows="3" placeholder="ì„ íƒì‚¬í•­"></textarea>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn-danger" onclick="closeRequestModal()">ì·¨ì†Œ</button>
                <button class="btn-success" onclick="submitRequest()">ì œì¶œ</button>
            </div>
        </div>
    </div>

<script>
    let schedules = [];
    let requests = [];
    let idCounter = 1;
    let currentRole = null;
    const rooms = ["B101", "101í˜¸", "102í˜¸", "201í˜¸", "202í˜¸", "203í˜¸", "204í˜¸", "205í˜¸", "206í˜¸", "207í˜¸", "208í˜¸", "209í˜¸", "301í˜¸", "302í˜¸", "303í˜¸", "ìŠ¤íŠœë””ì˜¤", "ê°•ë‹¹", "ìƒë‹´ì‹¤"];
    
    async function init() {
        populateRoomSelects();
        await loadFromCloud();
        updateRequestBadge();
        
        // ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
        if(Notification.permission === 'default') {
            Notification.requestPermission();
        }
        
        // ê´€ë¦¬ì ëª¨ë“œì¼ ë•Œë§Œ ì£¼ê¸°ì  ì²´í¬ ì‹œì‘
        if(currentRole === 'admin') {
            startNotificationCheck();
        }
    }
    
    let notificationCheckInterval = null;
    let lastRequestCount = 0;
    
    // ì•Œë¦¼ ì²´í¬ ì‹œì‘
    function startNotificationCheck() {
        // ì´ë¯¸ ì‹¤í–‰ ì¤‘ì´ë©´ ì¤‘ë‹¨
        if(notificationCheckInterval) {
            clearInterval(notificationCheckInterval);
        }
        
        // í˜„ì¬ ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ ê°œìˆ˜ ì €ì¥
        lastRequestCount = requests.filter(r => r.status === 'pending').length;
        
        // 30ì´ˆë§ˆë‹¤ ì²´í¬
        notificationCheckInterval = setInterval(checkForNewRequests, 30000);
    }
    
    // ì•Œë¦¼ ì²´í¬ ì¤‘ì§€
    function stopNotificationCheck() {
        if(notificationCheckInterval) {
            clearInterval(notificationCheckInterval);
            notificationCheckInterval = null;
        }
    }
    
    // ìƒˆ ìš”ì²­ í™•ì¸
    async function checkForNewRequests() {
        // localStorageì—ì„œ ìµœì‹  ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        const savedData = localStorage.getItem('classroom_data');
        if(!savedData) return;
        
        const data = JSON.parse(savedData);
        const currentRequests = data.requests || [];
        const pendingCount = currentRequests.filter(r => r.status === 'pending').length;
        
        // ìƒˆ ìš”ì²­ì´ ìˆìœ¼ë©´ ì•Œë¦¼
        if(pendingCount > lastRequestCount) {
            const newCount = pendingCount - lastRequestCount;
            showNotification(`ğŸ”” ìƒˆë¡œìš´ ê°•ì˜ì‹¤ ì‚¬ìš© ìš”ì²­ ${newCount}ê±´`, 
                           'ì‚¬ìš©ìš”ì²­ íƒ­ì—ì„œ í™•ì¸í•˜ì„¸ìš”.');
            
            // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            await loadFromCloud();
            updateRequestBadge();
        }
        
        lastRequestCount = pendingCount;
    }
    
    // ë¸Œë¼ìš°ì € ì•Œë¦¼ í‘œì‹œ
    function showNotification(title, message) {
        if(Notification.permission === 'granted') {
            const notification = new Notification(title, {
                body: message,
                icon: 'ğŸ“…',
                badge: 'ğŸ””',
                requireInteraction: true // ì‚¬ìš©ìê°€ ì§ì ‘ ë‹«ì„ ë•Œê¹Œì§€ ìœ ì§€
            });
            
            // ì•Œë¦¼ í´ë¦­ì‹œ ì‚¬ìš©ìš”ì²­ íƒ­ìœ¼ë¡œ ì´ë™
            notification.onclick = function() {
                window.focus();
                showTab('request');
                notification.close();
            };
            
            // 5ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹«ê¸° (requireInteractionì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ìš©)
            setTimeout(() => notification.close(), 5000);
        }
    }
    
    // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ (ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½í•˜ì„¸ìš”)
    const ADMIN_PASSWORD = "admin1234";
    
    function setRole(role) {
        // ê´€ë¦¬ì ëª¨ë“œ ì„ íƒ ì‹œ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        if(role === 'admin') {
            const password = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if(password !== ADMIN_PASSWORD) {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                return;
            }
        }
        
        currentRole = role;
        document.getElementById('roleSelector').style.display = 'none';
        document.getElementById('mainScreen').style.display = 'block';
        
        const roleText = role === 'admin' ? 'ğŸ‘¨â€ğŸ’¼ ê´€ë¦¬ì' : 'ğŸ‘¤ ì¼ë°˜ ì‚¬ìš©ì';
        document.getElementById('currentRole').textContent = roleText;
        
        document.getElementById('adminPanel').style.display = role === 'admin' ? 'block' : 'none';
        document.getElementById('userPanel').style.display = role === 'user' ? 'block' : 'none';
        
        updateRequestBadge();
        renderSchedule();
        renderRequests();
        
        // ê´€ë¦¬ì ëª¨ë“œì¼ ë•Œ ì•Œë¦¼ ì²´í¬ ì‹œì‘
        if(role === 'admin') {
            startNotificationCheck();
        } else {
            stopNotificationCheck();
        }
    }
    
    function changeRole() {
        document.getElementById('roleSelector').style.display = 'block';
        document.getElementById('mainScreen').style.display = 'none';
        currentRole = null;
        
        // ì•Œë¦¼ ì²´í¬ ì¤‘ì§€
        stopNotificationCheck();
    }
    
    function populateRoomSelects() {
        const select1 = document.getElementById('roomSelect');
        const select2 = document.getElementById('reqRoom');
        
        rooms.forEach(room => {
            select1.innerHTML += `<option value="${room}">${room}</option>`;
            select2.innerHTML += `<option value="${room}">${room}</option>`;
        });
    }
    
    function showTab(tabName) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        if(tabName === 'schedule') {
            document.querySelectorAll('.tab')[0].classList.add('active');
            document.getElementById('scheduleTab').classList.add('active');
        } else if(tabName === 'request') {
            document.querySelectorAll('.tab')[1].classList.add('active');
            document.getElementById('requestTab').classList.add('active');
        }
    }
    
    // í•´ë‹¹ ì›”ì˜ ìš”ì¼ë³„ ë‚ ì§œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    function getDates(year, month) {
        const result = {};
        const lastDay = new Date(year, month, 0).getDate();
        
        for(let i = 1; i <= lastDay; i++) {
            const day = new Date(year, month - 1, i).getDay();
            if(day >= 1 && day <= 6) {
                if(!result[day]) result[day] = [];
                result[day].push(i);
            }
        }
        return result;
    }
    
    // ì¼ì • ë Œë”ë§
    function renderSchedule() {
        const year = parseInt(document.getElementById('viewYear').value);
        const month = parseInt(document.getElementById('viewMonth').value);
        
        const thead = document.getElementById('scheduleHead');
        const tbody = document.getElementById('scheduleBody');
        
        const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        const datesMap = getDates(year, month);
        
        // í—¤ë”
        let headHtml = '<tr><th class="room-cell">ê°•ì˜ì‹¤</th>';
        for(let d = 1; d <= 6; d++) {
            const dates = datesMap[d] || [];
            headHtml += `<th>${dayNames[d]}<br><small>(${dates.join(' ')})</small></th>`;
        }
        headHtml += '</tr>';
        thead.innerHTML = headHtml;
        
        // ë³¸ë¬¸
        tbody.innerHTML = '';
        rooms.forEach(room => {
            const tr = document.createElement('tr');
            
            const tdRoom = document.createElement('td');
            tdRoom.className = 'room-cell';
            tdRoom.textContent = room;
            tr.appendChild(tdRoom);
            
            for(let d = 1; d <= 6; d++) {
                const td = document.createElement('td');
                
                const daySchedules = schedules.filter(s => 
                    s.y === year && s.m === month && s.r === room && s.d === d
                );
                
                daySchedules.sort((a, b) => a.st.localeCompare(b.st));
                
                daySchedules.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    
                    let html = `<strong>${item.st}~${item.et}</strong><br>${item.cn}`;
                    if(item.tn) html += `<br>${item.tn}`;
                    html += `<br><small>ğŸ“… ${item.dates.join(',')}ì¼</small>`;
                    
                    if(currentRole === 'admin') {
                        html += `<button class="del-btn" onclick="deleteSchedule(${item.id})">Ã—</button>`;
                    }
                    
                    card.innerHTML = html;
                    
                    // ê´€ë¦¬ìëŠ” ì¹´ë“œ ë”ë¸”í´ë¦­ìœ¼ë¡œ ê°™ì€ ê³¼ì •ëª… ì¼ê´„ ì‚­ì œ
                    if(currentRole === 'admin') {
                        const courseName = item.cn;
                        card.ondblclick = function() {
                            deleteAllByCourse(courseName);
                        };
                        card.title = 'ë”ë¸”í´ë¦­: ê°™ì€ ê³¼ì • ëª¨ë‘ ì‚­ì œ';
                        card.style.cursor = 'pointer';
                    }
                    
                    td.appendChild(card);
                });
                
                tr.appendChild(td);
            }
            
            tbody.appendChild(tr);
        });
        
        document.getElementById('totalCount').textContent = schedules.length;
    }
    
    // ê´€ë¦¬ì: ì§ì ‘ ì¼ì • ë“±ë¡
    async function addSchedule() {
        const startDate = new Date(document.getElementById('startDate').value);
        const endDate = new Date(document.getElementById('endDate').value);
        const room = document.getElementById('roomSelect').value;
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        const courseName = document.getElementById('courseName').value.trim();
        const instructorName = document.getElementById('instructorName').value.trim();
        
        if(!courseName) {
            alert('ê³¼ì •ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }
        
        const days = Array.from(document.querySelectorAll('input[name="chkDay"]:checked'))
            .map(cb => parseInt(cb.value));
        
        if(days.length === 0) {
            alert('ìš”ì¼ì„ ì„ íƒí•˜ì„¸ìš”.');
            return;
        }
        
        // ì„ íƒëœ ìš”ì¼ì— í•´ë‹¹í•˜ëŠ” ë‚ ì§œ ìˆ˜ì§‘ ë° ì¤‘ë³µ ì²´í¬ (ë…„ì›”ì¼ë¡œ ê·¸ë£¹í™”)
        const datesByYearMonthDay = {}; // {year: {month: {day: [dates]}}}
        const conflicts = [];
        
        for(let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
            const dayOfWeek = d.getDay();
            if(days.includes(dayOfWeek)) {
                const year = d.getFullYear();
                const month = d.getMonth() + 1;
                const date = d.getDate();
                
                // ì—°ë„-ì›”-ìš”ì¼ ë³„ë¡œ ë‚ ì§œ ì €ì¥
                if(!datesByYearMonthDay[year]) datesByYearMonthDay[year] = {};
                if(!datesByYearMonthDay[year][month]) datesByYearMonthDay[year][month] = {};
                if(!datesByYearMonthDay[year][month][dayOfWeek]) datesByYearMonthDay[year][month][dayOfWeek] = [];
                datesByYearMonthDay[year][month][dayOfWeek].push(date);
                
                // í•´ë‹¹ ë‚ ì§œì˜ ê°™ì€ ê°•ì˜ì‹¤ ì¼ì • ì°¾ê¸°
                const existingSchedules = schedules.filter(s => 
                    s.y === year && 
                    s.m === month && 
                    s.r === room && 
                    s.d === dayOfWeek &&
                    s.dates.includes(date)
                );
                
                // ì‹œê°„ ì¤‘ë³µ ì²´í¬
                for(let existing of existingSchedules) {
                    if(timeOverlap(startTime, endTime, existing.st, existing.et)) {
                        const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                        conflicts.push({
                            date: dateStr,
                            time: `${existing.st}~${existing.et}`,
                            course: existing.cn
                        });
                    }
                }
            }
        }
        
        // ì¤‘ë³µì´ ìˆìœ¼ë©´ ê²½ê³ 
        if(conflicts.length > 0) {
            let msg = 'âš ï¸ ë‹¤ìŒ ì¼ì •ê³¼ ì‹œê°„ì´ ì¤‘ë³µë©ë‹ˆë‹¤:\n\n';
            conflicts.forEach(c => {
                msg += `ğŸ“… ${c.date} ${c.time} - ${c.course}\n`;
            });
            msg += `\nì´ ${conflicts.length}ê°œì˜ ì¤‘ë³µì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.\nê·¸ë˜ë„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            
            if(!confirm(msg)) {
                return;
            }
        }
        
        // ì—°ë„-ì›”-ìš”ì¼ë³„ë¡œ ì¼ì • ì¶”ê°€
        for(const [year, monthData] of Object.entries(datesByYearMonthDay)) {
            for(const [month, dayData] of Object.entries(monthData)) {
                for(const [day, dates] of Object.entries(dayData)) {
                    schedules.push({
                        id: idCounter++,
                        y: parseInt(year),
                        m: parseInt(month),
                        d: parseInt(day),
                        r: room,
                        st: startTime,
                        et: endTime,
                        cn: courseName,
                        tn: instructorName,
                        dates: dates
                    });
                }
            }
        }
        
        await saveToCloud();
        
        if(conflicts.length > 0) {
            alert(`âš ï¸ ${conflicts.length}ê°œì˜ ì¤‘ë³µ ê²½ê³ ê°€ ìˆì—ˆì§€ë§Œ ì¼ì •ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        } else {
            alert('âœ“ ì¼ì •ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        document.getElementById('courseName').value = '';
        document.getElementById('instructorName').value = '';
        
        renderSchedule();
    }
    
    // ì‹œê°„ ì¤‘ë³µ ì²´í¬ í•¨ìˆ˜
    function timeOverlap(start1, end1, start2, end2) {
        return start1 < end2 && end1 > start2;
    }
    
    async function deleteSchedule(id) {
        if(!confirm('ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        schedules = schedules.filter(s => s.id !== id);
        await saveToCloud();
        renderSchedule();
    }
    
    // ê°™ì€ ê³¼ì •ëª…ì˜ ëª¨ë“  ì¼ì • ì‚­ì œ
    async function deleteAllByCourse(courseName) {
        // ê°™ì€ ê³¼ì •ëª…ì˜ ì¼ì • ì°¾ê¸°
        const sameCourseSched = schedules.filter(s => s.cn === courseName);
        
        if(sameCourseSched.length === 0) {
            alert('í•´ë‹¹ ê³¼ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        // ë‚ ì§œ ì •ë³´ ìˆ˜ì§‘
        const dateInfo = sameCourseSched.map(s => {
            const dateStr = s.dates.map(d => `${s.m}/${d}`).join(', ');
            return dateStr;
        }).join(', ');
        
        const msg = `"${courseName}" ê³¼ì •ì„ ì‚­ì œí•©ë‹ˆë‹¤.\n\n` +
                    `ì´ ${sameCourseSched.length}ê°œ ì¼ì •ì´ ìˆìŠµë‹ˆë‹¤.\n` +
                    `ë‚ ì§œ: ${dateInfo}\n\n` +
                    `ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
        
        if(!confirm(msg)) return;
        
        // í•´ë‹¹ ê³¼ì •ëª…ì˜ ëª¨ë“  ì¼ì • ì‚­ì œ
        schedules = schedules.filter(s => s.cn !== courseName);
        
        await saveToCloud();
        alert(`âœ“ "${courseName}" ê³¼ì • ${sameCourseSched.length}ê°œ ì¼ì •ì´ ëª¨ë‘ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        renderSchedule();
    }
    
    function openRequestModal() {
        document.getElementById('requestModal').classList.add('active');
        document.getElementById('reqDate').value = new Date().toISOString().split('T')[0];
    }
    
    function closeRequestModal() {
        document.getElementById('requestModal').classList.remove('active');
    }
    
    async function submitRequest() {
        const requesterName = document.getElementById('reqRequesterName').value.trim();
        const room = document.getElementById('reqRoom').value;
        const date = document.getElementById('reqDate').value;
        const startTime = document.getElementById('reqStartTime').value;
        const endTime = document.getElementById('reqEndTime').value;
        const courseName = document.getElementById('reqCourseName').value.trim();
        const instructorName = document.getElementById('reqInstructorName').value.trim();
        const purpose = document.getElementById('reqPurpose').value.trim();
        
        if(!requesterName || !date || !courseName) {
            alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }
        
        const newRequest = {
            id: idCounter++,
            requester_name: requesterName,
            room: room,
            date: date,
            start_time: startTime,
            end_time: endTime,
            course_name: courseName,
            instructor_name: instructorName,
            purpose: purpose,
            status: 'pending',
            created_at: new Date().toISOString()
        };
        
        requests.push(newRequest);
        await saveToCloud();
        
        // ì•Œë¦¼ ì €ì¥ (ê´€ë¦¬ìê°€ ë‚˜ì¤‘ì— ë¡œê·¸ì¸í–ˆì„ ë•Œ í™•ì¸ ê°€ëŠ¥)
        localStorage.setItem('classroom_new_request_flag', 'true');
        
        alert('ìš”ì²­ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.');
        closeRequestModal();
        
        document.getElementById('reqRequesterName').value = '';
        document.getElementById('reqCourseName').value = '';
        document.getElementById('reqInstructorName').value = '';
        document.getElementById('reqPurpose').value = '';
        
        updateRequestBadge();
        renderRequests();
    }
    
    function renderRequests() {
        const container = document.getElementById('requestList');
        const isAdmin = currentRole === 'admin';
        
        if(requests.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        container.innerHTML = requests.map(req => {
            const statusClass = 'status-' + req.status;
            const statusText = req.status === 'pending' ? 'ëŒ€ê¸°ì¤‘' : 
                              req.status === 'approved' ? 'ìŠ¹ì¸' : 'ë°˜ë ¤';
            
            return `
                <div class="request-item">
                    <div class="request-header">
                        <strong>${req.requester_name}</strong>
                        <span class="${statusClass} request-status">${statusText}</span>
                    </div>
                    <div class="request-info">
                        <strong>ê°•ì˜ì‹¤:</strong> ${req.room}<br>
                        <strong>ë‚ ì§œ:</strong> ${req.date}<br>
                        <strong>ì‹œê°„:</strong> ${req.start_time} ~ ${req.end_time}<br>
                        <strong>ê³¼ì •ëª…:</strong> ${req.course_name}<br>
                        ${req.instructor_name ? `<strong>ê°•ì‚¬:</strong> ${req.instructor_name}<br>` : ''}
                        ${req.purpose ? `<strong>ëª©ì :</strong> ${req.purpose}<br>` : ''}
                        ${req.reject_reason ? `<strong style="color: #dc3545;">ë°˜ë ¤ì‚¬ìœ :</strong> ${req.reject_reason}<br>` : ''}
                    </div>
                    ${req.status === 'pending' && isAdmin ? `
                        <div class="request-actions">
                            <button class="btn-success" onclick="approveRequest(${req.id})">âœ“ ìŠ¹ì¸</button>
                            <button class="btn-danger" onclick="rejectRequest(${req.id})">âœ— ë°˜ë ¤</button>
                        </div>
                    ` : ''}
                </div>
            `;
        }).join('');
    }
    
    async function approveRequest(id) {
        const request = requests.find(r => r.id === id);
        if(!request) return;
        
        // ì¤‘ë³µ ì²´í¬
        const dateObj = new Date(request.date);
        const year = dateObj.getFullYear();
        const month = dateObj.getMonth() + 1;
        const date = dateObj.getDate();
        const dayOfWeek = dateObj.getDay();
        
        const existingSchedules = schedules.filter(s => 
            s.y === year && 
            s.m === month && 
            s.r === request.room && 
            s.d === dayOfWeek &&
            s.dates.includes(date)
        );
        
        let conflicts = [];
        for(let existing of existingSchedules) {
            if(timeOverlap(request.start_time, request.end_time, existing.st, existing.et)) {
                conflicts.push({
                    time: `${existing.st}~${existing.et}`,
                    course: existing.cn
                });
            }
        }
        
        // ì¤‘ë³µì´ ìˆìœ¼ë©´ ê²½ê³ 
        if(conflicts.length > 0) {
            let msg = 'âš ï¸ ì´ ìš”ì²­ì€ ë‹¤ìŒ ì¼ì •ê³¼ ì‹œê°„ì´ ì¤‘ë³µë©ë‹ˆë‹¤:\n\n';
            conflicts.forEach(c => {
                msg += `${c.time} - ${c.course}\n`;
            });
            msg += '\nì¤‘ë³µë˜ëŠ” ì¼ì •ì´ ìˆì§€ë§Œ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
            
            if(!confirm(msg)) {
                return;
            }
        } else {
            if(!confirm('ì´ ìš”ì²­ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        }
        
        request.status = 'approved';
        
        schedules.push({
            id: idCounter++,
            y: year,
            m: month,
            d: dayOfWeek,
            r: request.room,
            st: request.start_time,
            et: request.end_time,
            cn: request.course_name,
            tn: request.instructor_name || '',
            dates: [date]
        });
        
        await saveToCloud();
        
        if(conflicts.length > 0) {
            alert('âš ï¸ ì¤‘ë³µ ê²½ê³ ê°€ ìˆì—ˆì§€ë§Œ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ë°°ì •í‘œì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
            alert('âœ“ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ë°°ì •í‘œì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        updateRequestBadge();
        renderRequests();
        renderSchedule();
    }
    
    async function rejectRequest(id) {
        const reason = prompt('ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
        if(!reason) return;
        
        const request = requests.find(r => r.id === id);
        if(!request) return;
        
        request.status = 'rejected';
        request.reject_reason = reason;
        
        await saveToCloud();
        alert('ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤.');
        
        updateRequestBadge();
        renderRequests();
    }
    
    function updateRequestBadge() {
        const pendingCount = requests.filter(r => r.status === 'pending').length;
        const badge = document.getElementById('requestBadge');
        
        if(pendingCount > 0 && currentRole === 'admin') {
            badge.textContent = pendingCount;
            badge.style.display = 'inline';
        } else {
            badge.style.display = 'none';
        }
    }
    
    function setSyncStatus(status) {
        const statusEl = document.getElementById('syncStatus');
        statusEl.className = 'sync-status ' + status;
        
        if(status === 'synced') {
            statusEl.textContent = 'âœ“ ì €ì¥ë¨';
        } else if(status === 'syncing') {
            statusEl.textContent = 'âŸ³ ì €ì¥ ì¤‘...';
        } else if(status === 'error') {
            statusEl.textContent = 'âœ— ì˜¤ë¥˜';
        }
    }
    
    async function saveToCloud() {
        try {
            setSyncStatus('syncing');
            
            const data = {
                schedules: schedules,
                requests: requests,
                idCounter: idCounter,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('classroom_data', JSON.stringify(data));
            setSyncStatus('synced');
        } catch(error) {
            console.error('ì €ì¥ ì˜¤ë¥˜:', error);
            setSyncStatus('error');
            alert('ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
    }
    
    async function loadFromCloud() {
        try {
            setSyncStatus('syncing');
            const savedData = localStorage.getItem('classroom_data');
            
            if(savedData) {
                const data = JSON.parse(savedData);
                schedules = data.schedules || [];
                requests = data.requests || [];
                idCounter = data.idCounter || 1;
            }
            
            setSyncStatus('synced');
            renderSchedule();
            renderRequests();
        } catch(error) {
            console.error('ë¡œë“œ ì˜¤ë¥˜:', error);
            setSyncStatus('synced');
        }
    }
    
    async function refreshData() {
        await loadFromCloud();
        updateRequestBadge();
        alert('ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤.');
    }
    
    // CSV ìƒ˜í”Œ ë‹¤ìš´ë¡œë“œ
    function downloadSampleCSV() {
        const sampleData = `ê°•ì¢Œëª…,ê°•ì˜ì‹¤,ì‹œì‘ì¼,ì¢…ë£Œì¼,ìš”ì¼,ì‹œì‘ì‹œê°„,ì¢…ë£Œì‹œê°„,ê°•ì‚¬ëª…
ì—‘ì…€ê¸°ì´ˆ,207í˜¸,2026-04-20,2026-05-18,ì›”í™”ìˆ˜ëª©ê¸ˆ,13:00,17:00,ê¹€ì² ìˆ˜
íŒŒì›Œí¬ì¸íŠ¸ê¸°ì´ˆ,207í˜¸,2026-06-01,2026-06-29,ì›”ìˆ˜ê¸ˆ,13:00,17:00,ì´ì˜í¬
Pythonì…ë¬¸,301í˜¸,2026-04-15,2026-06-10,í™”ëª©,09:00,12:00,ë°•ë¯¼ìˆ˜`;
        
        const blob = new Blob(['\uFEFF' + sampleData], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'ê°•ì˜ì‹¤ë°°ì •_ìƒ˜í”Œ.csv';
        link.click();
    }
    
    // ìš”ì¼ ë¬¸ìì—´ì„ ìˆ«ì ë°°ì—´ë¡œ ë³€í™˜
    function parseDays(dayString) {
        const dayMap = {
            'ì›”': 1, 'í™”': 2, 'ìˆ˜': 3, 'ëª©': 4, 'ê¸ˆ': 5, 'í† ': 6
        };
        
        // ì‰¼í‘œ ì œê±°
        dayString = dayString.replace(/,/g, '');
        
        const days = [];
        for(let char of dayString) {
            if(dayMap[char]) {
                days.push(dayMap[char]);
            }
        }
        
        return days;
    }
    
    // CSV ì—…ë¡œë“œ ë° íŒŒì‹±
    async function uploadCSV() {
        const fileInput = document.getElementById('csvFile');
        const file = fileInput.files[0];
        
        if(!file) {
            alert('CSV íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.');
            return;
        }
        
        const reader = new FileReader();
        
        reader.onload = async function(e) {
            try {
                const text = e.target.result;
                const lines = text.split('\n').filter(line => line.trim());
                
                if(lines.length < 2) {
                    alert('CSV íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                let successCount = 0;
                let errorCount = 0;
                const errors = [];
                
                // ì²« ì¤„ì€ í—¤ë”ì´ë¯€ë¡œ ìŠ¤í‚µ
                for(let i = 1; i < lines.length; i++) {
                    try {
                        const line = lines[i].trim();
                        if(!line) continue;
                        
                        // CSV íŒŒì‹± (ì‰¼í‘œë¡œ ë¶„ë¦¬, ë”°ì˜´í‘œ ê³ ë ¤)
                        const values = line.split(',').map(v => v.trim().replace(/^["']|["']$/g, ''));
                        
                        if(values.length < 8) {
                            errors.push(`${i}í–‰: í•„ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤ (${values.length}/8)`);
                            errorCount++;
                            continue;
                        }
                        
                        const [courseName, room, startDateStr, endDateStr, dayStr, startTime, endTime, instructorName] = values;
                        
                        // ë‚ ì§œ í˜•ì‹ ë³€í™˜ (YYYY-MM-DD)
                        const startDate = new Date(startDateStr);
                        const endDate = new Date(endDateStr);
                        
                        if(isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                            errors.push(`${i}í–‰: ë‚ ì§œ í˜•ì‹ ì˜¤ë¥˜ (YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”)`);
                            errorCount++;
                            continue;
                        }
                        
                        // ìš”ì¼ íŒŒì‹±
                        const days = parseDays(dayStr);
                        
                        if(days.length === 0) {
                            errors.push(`${i}í–‰: ìš”ì¼ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤ (${dayStr})`);
                            errorCount++;
                            continue;
                        }
                        
                        // ì„ íƒëœ ìš”ì¼ì— í•´ë‹¹í•˜ëŠ” ë‚ ì§œ ìˆ˜ì§‘
                        const datesByYearMonthDay = {};
                        
                        for(let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                            const dayOfWeek = d.getDay();
                            if(days.includes(dayOfWeek)) {
                                const year = d.getFullYear();
                                const month = d.getMonth() + 1;
                                const date = d.getDate();
                                
                                if(!datesByYearMonthDay[year]) datesByYearMonthDay[year] = {};
                                if(!datesByYearMonthDay[year][month]) datesByYearMonthDay[year][month] = {};
                                if(!datesByYearMonthDay[year][month][dayOfWeek]) datesByYearMonthDay[year][month][dayOfWeek] = [];
                                datesByYearMonthDay[year][month][dayOfWeek].push(date);
                            }
                        }
                        
                        // ì—°ë„-ì›”-ìš”ì¼ë³„ë¡œ ì¼ì • ì¶”ê°€
                        for(const [year, monthData] of Object.entries(datesByYearMonthDay)) {
                            for(const [month, dayData] of Object.entries(monthData)) {
                                for(const [day, dates] of Object.entries(dayData)) {
                                    schedules.push({
                                        id: idCounter++,
                                        y: parseInt(year),
                                        m: parseInt(month),
                                        d: parseInt(day),
                                        r: room,
                                        st: startTime,
                                        et: endTime,
                                        cn: courseName,
                                        tn: instructorName,
                                        dates: dates
                                    });
                                }
                            }
                        }
                        
                        successCount++;
                        
                    } catch(err) {
                        errors.push(`${i}í–‰: ${err.message}`);
                        errorCount++;
                    }
                }
                
                await saveToCloud();
                renderSchedule();
                
                let message = `âœ… ì—…ë¡œë“œ ì™„ë£Œ!\n\nì„±ê³µ: ${successCount}ê°œ\nì‹¤íŒ¨: ${errorCount}ê°œ`;
                
                if(errors.length > 0 && errors.length <= 5) {
                    message += '\n\nì˜¤ë¥˜ ë‚´ìš©:\n' + errors.join('\n');
                } else if(errors.length > 5) {
                    message += '\n\nì˜¤ë¥˜ ë‚´ìš© (ì²˜ìŒ 5ê°œë§Œ í‘œì‹œ):\n' + errors.slice(0, 5).join('\n');
                }
                
                alert(message);
                
                // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
                fileInput.value = '';
                
            } catch(err) {
                alert('CSV íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
            }
        };
        
        reader.readAsText(file, 'UTF-8');
    }
    
    init();
</script>
</body>
</html>
